# AppArmor profile for mpv media player
# Version of mpv profiled: 1:0.35.1
# Homepage: https://github.com/krathalan/apparmor-profiles
# Copyright 2019-2023 (C) krathalan, mortezadadgar; Licensed under GPLv3
abi <abi/3.0>,

include <tunables/global>

# AppArmor profile for mpv media player
# Version of mpv profiled: 1:0.35.1
# Homepage: https://github.com/krathalan/apparmor-profiles
# Copyright 2019-2023 (C) krathalan, mortezadadgar; Licensed under GPLv3


profile mpv /usr/bin/mpv {
  include <abstractions/audio>
  include <abstractions/base>
  include <abstractions/fonts>
  include <abstractions/krathalans-common-gui>
  include <abstractions/krathalans-hwaccel>
  include <abstractions/krathalans-networking>
  include if exists <local/mpv>

  deny capability chown,
  deny capability mknod,
  deny capability syslog,

  network inet dgram,
  network inet stream,
  network inet6 dgram,
  network inet6 stream,
  network netlink raw,

  signal receive set=term peer=streamlink,
  signal send set=kill peer=yt-dlp,

  deny /dev/tty rw,
  deny /etc/igfx_* w,
  deny /tmp/** mrw,
  deny /usr/bin/xdg-screensaver rx,
  deny /usr/bin/{bash,dash} rx,
  deny /{,var/}run/systemd/userdb/ r,
  deny @{HOME}/**/mpv-shot* w,
  deny @{HOME}/.nv/.* mrw,
  deny @{PROC}/*/cmdline r,
  deny @{PROC}/*/comm r,
  deny @{PROC}/*/task/{,**} rw,
  deny @{PROC}/sys/vm/mmap_min_addr r,
  deny @{system_share_dirs}/p11-kit/modules/ r,
  deny @{sys}/bus/pci/devices/ r,
  deny @{sys}/devices/system/node/ r,
  deny owner @{HOME}/.bash_history rw,
  deny owner @{HOME}/.librewolf/{,**} rw,
  deny owner @{HOME}/.local/share/gnupg/{,**} rw,
  deny owner @{HOME}/.mozilla/{,**} rw,
  deny owner @{HOME}/.ssh{,**} rw,
  deny owner @{HOME}/zsh/.zsh_history rw,

  /etc/alsa/conf.d/** r,
  /etc/asound.conf r,
  /etc/igfx_* r,
  /etc/libva.conf r,
  /etc/mpv/** r,
  /etc/pipewire/{,**} r,
  /opt/intel/mediasdk/lib/libmfx.so.* mr,
  /proc/sys/dev/i915/perf_stream_paranoid r,
  /usr/bin/mpv r,
  /usr/bin/pulseaudio rPx,
  /usr/bin/yt-dlp rUx,
  /usr/share/pipewire/client-rt.conf r,
  @{system_share_dirs}/libdrm/* r,
  @{system_share_dirs}/pipewire/client.conf r,
  @{sys}/devices/pci[0-9]*/**/drm/{,**} r,
  @{sys}/devices/pci[0-9]*/**/{config,irq,revision,resource} r,
  @{sys}/devices/system/cpu/possible r,
  owner /dev/shm/jack_db-1000/ w,
  owner /home/*/repos/dotfiles/pulse/.config/pulse/cookie k,
  owner /run/media/*/ r,
  owner /run/media/*/** r,
  owner @{HOME}/ r,
  owner @{HOME}/** r,
  owner @{HOME}/.config/mpv/{,**} rw,

}
